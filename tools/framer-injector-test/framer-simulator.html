<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Framer Manifest Simulator</title>
    <style>
        body {
            background: #222;
            color: #eee;
            font-family: monospace;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 90vh;
        }

        .header {
            margin-bottom: 20px;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }

        .container {
            flex: 1;
            border: 2px solid #00d9ff;
            background: #000;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>Framer Code Component Simulator</h1>
        <p>Status: <span id="status" style="color: yellow">Waiting for Player...</span></p>
        <button onclick="sendManifest()">Force Resend Manifest</button>
    </div>

    <div class="container">
        <!-- Embed the Universal Player -->
        <iframe id="player-frame" src="universal-player.html" onload="console.log('Iframe loaded')"></iframe>
    </div>

    <script>
        // -------------------------------------------------------
        // 1. THE "LOCAL" MANIFEST (What you would type in Framer)
        // -------------------------------------------------------
        const TEST_MANIFEST = {
            "title": "Injected Lesson Demo",
            "description": "This content was injected via postMessage from the parent window.",
            "theme": { "primaryColor": "#ff0088", "fontBody": "Rajdhani, sans-serif" },
            "modules": [
                {
                    "id": "inject.1",
                    "title": "Injection Successful",
                    "type": "progressive-disclosure",
                    "content": {
                        "sections": [
                            {
                                "title": "System Online",
                                "content": "<p>If you are reading this, the <strong>Universal Player</strong> successfully received the JSON payload from the parent window.</p>",
                                "triggerLabel": "Test Interaction"
                            },
                            {
                                "title": "Media Test",
                                "content": "<p>Since this manifest is remote (in theory), we must test remote assets.</p><p><em>(In this local test, we still assume relative paths work because we are in the same folder structure, but in Framer, these must be absolute URLs.)</em></p>",
                                "triggerLabel": "Finish"
                            }
                        ]
                    },
                    "artifacts": [
                        { "id": "injected_token", "label": "Injection Token", "icon": "ðŸ’‰", "trigger": "step_complete" }
                    ]
                },
                // MODULE 2: Asset Test
                {
                    "id": "inject.2",
                    "title": "Asset Stream Test",
                    "type": "progressive-disclosure",
                    "content": {
                        "sections": [
                            {
                                "title": "Remote Visuals",
                                "content": "<p>Testing image asset loading via injected JSON.</p>",
                                "triggerLabel": "Check Video",
                                "media": {
                                    "type": "image",
                                    "src": "https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=600&auto=format&fit=crop",
                                    "position": "right",
                                    "alt": "Cyberpunk Connection"
                                }
                            },
                            {
                                "title": "Video Stream",
                                "content": "<p>Testing remote video asset playback.</p>",
                                "media": {
                                    "type": "video",
                                    "src": "https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4",
                                    "autoplay": true
                                }
                            }
                        ]
                    }
                }
            ]
        };

        // -------------------------------------------------------
        // 2. FRAMER LOGIC (The "Sender")
        // -------------------------------------------------------
        const frame = document.getElementById('player-frame');
        const status = document.getElementById('status');

        function sendManifest() {
            status.textContent = 'Sending Manifest...';
            status.style.color = 'cyan';

            // Send to Iframe
            frame.contentWindow.postMessage({
                type: 'LOAD_MANIFEST',
                manifest: TEST_MANIFEST
            }, '*');
        }

        // Listen for "PLAYER_READY" signal
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'PLAYER_READY') {
                console.log('[Simulator] Player signaled READY.');
                status.textContent = 'Player Ready. Sending Data...';

                // Slight delay to simulate network/parsing time
                setTimeout(sendManifest, 500);
            }
        });

    </script>
</body>

</html>